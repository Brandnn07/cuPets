{{#if loggedIn}}
{{#each userProfile as |userProfile| }}
<div class="card">
  <div class="card-content">
    <div class="picture">
      user picture
    </div>
    <p class="title">
      This is: {{userProfile.name}}
    </p>
    <p class="subtitle">
      Person's description: {{userProfile.description}}
    </p>
    <p class="subtitle">
      Their pet type: {{userProfile.pet_type}}
    </p>
    <p class="subtitle">
      Their pet name: {{userProfile.pet_name}}
    </p>
  </div>
  <footer class="card-footer">
    <p class="card-footer-item">
      <span>
        <a class="is-warning" href=""> I'll pass..</a>
      </span>
    </p>
    <p class="card-footer-item">
      <span>
        <a href="/new-message"> Message them!</a>
      </span>
    </p>
  </footer>
</div>
  {{/each}}
  {{/if}}
</body>


{{#if loggedIn}}
<div class="card">
  <div class="card-content">
    <p class="title">
      Welcome, {{userProfile.name}}!
      We hope you are having a good day!
    </p>
  </div>
</div>

<div class="card">
  <div class="card-content">
  </div>
</div>
<div class="card">
  <div class="card-content">
    <div class="picture">
      user picture
    </div>
    <div class="title">
      Hey I'm {{userProfile.name}}!
    </div>
    <p class="subtitle">
      @{{userProfile.user_name}}
    </p>
    <p class="subtitle">
      {{userProfile.description}}
    </p>
  </div>
</div>

--------------------------------------------------------

<div class="card">
  <div class="card-content">
    <div class="picture">
      pet picture
    </div>
    <p class="subtitle">
      Their name is: {{userProfile.pet_name}}!
    </p>
    <p class="subtitle">
      And their type is: {{userProfile.pet_type}}!
    </p>
    <p>
      psst. If you want to know more about my pet or me don't be afraid to <a>message me!</a>
    </p>
  </div>
</div>
{{/if}}

<script src="../js/.js"></script>




--------------------------------------------------------

const router = require('express').Router();
// const { Post } = require('../../models');
const { Profile } = require('../../models');
const withAuth = require('../../utils/auth');

router.post('/', async (req, res) => {
    try {
        const newProfile = await Profile.create({
            name: req.body.name,
            user_name: req.body.user_name,
            email: req.body.email,
            password: req.body.password,
            description: req.body.description,
            pet_name: req.body.pet_name,
            pet_type: req.body.pet_type,
            pet_interest: req.body.pet_interest,
        });

        req.session.save(() => {
            req.session.profile_id = newProfile.id;
            req.session.loggedIn = true;

            res.status(200).json(req.body);
        });
    } catch (err) {
        console.log(err);
        res.status(500).json(err);
    }
});

router.post('/login', async (req, res) => {
    try {

        const profileData = await Profile.findOne({ where: { user_name: req.body.user_name } });
        console.log(req.body.user_name)

        if (!profileData) {
            res
                .status(400)
                .json({ message: 'Incorrect username or password, please try again' });
            return;
        }

        const validPassword = await profileData.checkPassword(req.body.password);
        if (!validPassword) {
            res
                .status(400)
                .json({ message: 'Incorrect username or password, please try again' });
            return;
        }
        console.log(profileData)
        console.log(validPassword)

        req.session.save(() => {
            req.session.profile_id = profileData.id;
            req.session.loggedIn = true;

            res.json({ profile: profileData, message: 'You are now logged in!' });
        });

    } catch (err) {
        console.log(err);
        res.status(400).json(err);
    }
});

// router.get('/one', withAuth, async (req, res) => {
//     try {
//         const profileData = await Profile.findOne({
//             where: {
//                 id: req.session.profile_id
//             }
//         });

//         const userProfile = JSON.parse(JSON.stringify(profileData));

//         res.status(200).json(userProfile);

//     } catch (err) {
//         res.status(500).json(err);
//     }
// });

router.delete('/:id', withAuth, async (req, res) => {
    try {
        const profileData = await Profile.destroy({
            where: {
                id: req.params.id,
                profile_id: req.session.profile_id,
            },
        });

        if (!profileData) {
            res.status(404).json({ message: 'No profile found with this id' });
            return;
        }

        res.status(200).json(profileData);
    } catch (err) {
        res.status(500).json(err);
    }
});

router.post('/logout', (req, res) => {
    if (req.session.loggedIn) {
        req.session.destroy(() => {
            res.status(204).end();
        });
    } else {
        res.status(404).end();
    }
});

module.exports = router;

--------------------------------------------------------

const router = require('express').Router();
const { Post, Profile } = require('../models');
const withAuth = require('../utils/auth');


// Gets info from posts onto dashboard
router.get('/', withAuth, async (req, res) => {
    if(req.session.loggedIn) {
        res.redirect('/home');
        return;
    }

    res.render('login');
});

router.get('/login', async (req, res) => {
    if(req.session.loggedIn) {
        res.redirect('/home');
        return;
    }
    res.render('login');
});
// Paths to settings
router.get('/settings', async (req, res) => {
    const profileData = await Profile.findOne({
        where: {
            id: req.session.profile_id
        }
    });

    const userProfile = JSON.parse(JSON.stringify(profileData));

    res.render('settings', {
        loggedIn: req.session.loggedIn,
        userProfile
    });
});

router.get('/home', async (req, res) => {
    const profileData = await Profile.findAll({
        where: {
            id: req.session.profile_id
        }
    });

    const userProfile = JSON.parse(JSON.stringify(profileData));

    res.render('home', {
        loggedIn: req.session.loggedIn,
        userProfile
    });
});

router.get('/profile', async (req, res) => {
    const profileData = await Profile.findOne({
        where: {
            id: req.session.profile_id
        }
    });

    const userProfile = JSON.parse(JSON.stringify(profileData));

    res.render('profile', {
        loggedIn: req.session.loggedIn,
        userProfile
    });
})

router.get('/inbox', async (req, res) => {
    const profileData = await Profile.findOne({
        where: {
            id: req.session.profile_id
        }
    });

    const userProfile = JSON.parse(JSON.stringify(profileData));

    res.render('inbox', {
        loggedIn: req.session.loggedIn,
        userProfile
    });
})

router.get('/signup', async (req, res) => {
    const profileData = await Profile.findOne({
        where: {
            id: req.session.profile_id
        }
    });

    const userProfile = JSON.parse(JSON.stringify(profileData));

    res.render('signup', {
        loggedIn: req.session.loggedIn,
        userProfile
    });
});

router.get('/feedback', async (req, res) => {
    const profileData = await Profile.findOne({
        where: {
            id: req.session.profile_id
        }
    });

    const userProfile = JSON.parse(JSON.stringify(profileData));

    res.render('feedback', {
        loggedIn: req.session.loggedIn,
        userProfile
    });
});

router.get('/aboutus', async (req, res) => {
    const profileData = await Profile.findOne({
        where: {
            id: req.session.profile_id
        }
    });

    const userProfile = JSON.parse(JSON.stringify(profileData));

    res.render('aboutus', {
        loggedIn: req.session.loggedIn,
        userProfile
    });
});

module.exports = router;

